<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1024, user-scalable=no">
    <link href='./loader.css' rel='stylesheet' type='text/css'>
    <link href='./styles.css' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
  </head>
  <body ng-app="myApp" ng-controller='demoController'>

    <div class="ng-cloak enable_touchmove" snap-shelves="">
      <div id="shelf-1" snap-shelf="">
        <ul class="list ">
            <li class="list-divider">Galleries demos</li>
            <li><a ng-click="snapper.close()"><img width="50" height="50" src="http://a1.twimg.com/profile_images/1244148446/logo-revolunet-carre2_reasonably_small.jpg" class="avatar"> </a></li>
            <li class="list-divider">Luxury houses</li>
            <li><a ng-click="load('luxury house paris');snapper.close()">Paris</a></li>
            <li><a ng-click="load('luxury house new york');snapper.close()">New York</a></li>
            <li><a ng-click="load('luxury house miami');snapper.close()">Miami</a></li>
            <li><a ng-click="load('luxury house san francisco');snapper.close()">San Francisco</a></li>
            <li class="list-divider">Luxury cars</li>
            <li><a ng-click="load('luxury car france');snapper.close()">France</a></li>
            <li><a ng-click="load('luxury car usa');snapper.close()">USA</a></li>
            <li><a ng-click="load('luxury car italy');snapper.close()">Italy</a></li>
            <li class="list-divider">Hi-tech</li>
            <li><a ng-click="load('electric bikes');snapper.close()">Electric bikes</a></li>
            <li><a ng-click="load('google car');snapper.close()">Google cars</a></li>
            <li><a ng-click="load('google class');snapper.close()">Google glass</a></li>
        </ul>
      </div>
    </div>

    <div id="content" snap-content="" class="enable_touchmove" snap-options='{ "maxPosition": 200, "touchToDrag": false }'>
      <header class="bar-title">
        <a class="button" href='#' ng-click="snapper.toggle('left')">
          Menu
        </a>
        <h1 class="title">AngularJS Carousel + Flickr demo</h1>
        <a class="button" href="http://github.com/revolunet/angular-carousel">
          About
        </a>
      </header>

      <div class="loading" ng-hide="!loading">
        <br><br><br>
        <div id="floatingCirclesG">
          <div class="f_circleG" id="frotateG_01"></div>
          <div class="f_circleG" id="frotateG_02"></div>
          <div class="f_circleG" id="frotateG_03"></div>
          <div class="f_circleG" id="frotateG_04"></div>
          <div class="f_circleG" id="frotateG_05"></div>
          <div class="f_circleG" id="frotateG_06"></div>
          <div class="f_circleG" id="frotateG_07"></div>
          <div class="f_circleG" id="frotateG_08"></div>
        </div>
      </div>

      <ul rn-carousel rn-carousel-buffered class="image-page">
        <li ng-repeat="page in pages">
          <div class="page page{{ page.tpl }}" ng-class="{active: ($index == activeIndex) }">
            <div ng-click="toggle(page, 0)" ng-class="page[0].cls">
              <div class="img" ng-style="{'background-image': 'url(\'' + page[0].url + '\')'}">
                <div class="layer">{{ page[0].title }}</div>
              </div>
            </div>
            <div ng-click="toggle(page, 1)" ng-class="page[1].cls">
              <div class="img" ng-style="{'background-image': 'url(\'' + page[1].url + '\')'}">
                <div class="layer">{{ page[1].title }}</div>
              </div>
            </div>
            <div ng-click="toggle(page, 2)" ng-class="page[2].cls">
              <div class="img" ng-style="{'background-image': 'url(\'' + page[2].url + '\')'}">
                <div class="layer">{{ page[2].title }}</div>
              </div>
            </div>
            <div ng-click="toggle(page, 3)" ng-class="page[3].cls">
              <div class="img" ng-style="{'background-image': 'url(\'' + page[3].url + '\')'}">
                <div class="layer">{{ page[3].title }}</div>
              </div>
            </div>
            <div ng-click="toggle(page, 4)" ng-class="page[4].cls">
              <div class="img" ng-style="{'background-image': 'url(\'' + page[4].url + '\')'}">
                <div class="layer">{{ page[4].title }}</div>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <script src="//code.angularjs.org/1.1.4/angular.js"></script>
    <script src="../../lib/angular-mobile.js"></script>
    <script src="./angular-snap.min.js"></script>
    <script src="./snap.js"></script>

    <!-- include carousel src -->
    <script src="../../src/angular-carousel.js"></script>
    <link href='../../src/angular-carousel.css' rel='stylesheet' type='text/css'>

    <script>

    document.ontouchmove = function(event) {
        // provent body move (ipad)
        var sourceElement = event.target || event.srcElement;
        if(!angular.element(sourceElement).hasClass('enable_touchmove')) {
          e.preventDefault();
        }
    };

    function partition(items, size) {
      var p = [];
      for (var i=Math.floor(items.length/size); i-->0; ) {
          p[i]=items.slice(i*size, (i+1)*size);
      }
      return p;
    }

    angular.module('myApp', ['angular-carousel', 'snap'])
      .controller('demoController', function($scope, $http) {

        var page = 1,
            maxPages = 3,
            term = null;

        function fetch() {
          // fetch a single result page
          var params = {
            method: 'flickr.photos.search',
            api_key: '98a83da50faeef3886249aef8ee3903e',
            text: term,
            per_page: 50,
            page: page,
            format: 'json'
          };
          $http.jsonp('http://api.flickr.com/services/rest/', {params: params});
        }

        window.jsonFlickrApi = function(result) {
          // flickr callback
          var newPics = [];
          angular.forEach(result.photos.photo, function(data) {
            newPics.push({
              url: "http://farm" + data.farm + ".staticflickr.com/" + data.server + "/" + data.id + "_" + data.secret + "_m.jpg",
              title: data.title,
              cls: ''
            });
          });

          // add to existing data
          $scope.pics = $scope.pics.concat(newPics);

          var newPages = partition(newPics, 5);
          angular.forEach(newPages, function(page) {
            page.tpl = Math.floor(Math.random() * 4) + 1;
          });

          $scope.pages = $scope.pages.concat(newPages);

          if (page < maxPages) {
            // fetch some more pages
            page += 1;
            fetch();
          } else {
            $scope.loading = false;
          }
        }

        function getItemPos(page, idx) {
          if (idx < 2 || (idx == 2 && page.tpl > 2)) return 'top';
          return 'bottom';
        }

        $scope.toggle = function(page, idx) {
          // toggle image zoom
          if (page[idx].cls == 'maximize') {
            // restore
            angular.forEach(page, function(item, idx2) {
              item.cls = '';
            });
            return;
          }
          var clickPos = getItemPos(page, idx);
          angular.forEach(page, function(item, idx2) {
            var hidePos = getItemPos(page, idx2);
            item.cls = 'hide-' + hidePos + '-from-' + clickPos;
          });
          page[idx].cls = 'maximize';
        }

        function load(kwd) {
          $scope.loading = true;
          term = kwd;
          page = 1;
          $scope.pics = [];
          $scope.pages = [];
          fetch();
        }

        // default search
        load('luxury house');
        $scope.load = load;
      });

    </script>
  </body>
</html>

