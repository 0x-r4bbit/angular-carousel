/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.8 - 2013-06-17
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-carousel",["ngMobile"]).filter("carouselSlice",function(){return function(e,n,a){return e.slice(n,a)}}).directive("rnCarousel",["$compile","$parse","$swipe",function(e,n,a){var t=0;return{restrict:"A",scope:!0,compile:function(r,i){r.addClass("rn-carousel-slides");var s=r.find("li")[0].attributes["ng-repeat"],u=s.value.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),o=u[1],l=u[2],c=u[3]||"",d=angular.isDefined(i.rnCarouselBuffered);if(d){var f="|carouselSlice:carouselBufferStart:carouselBufferStart+carouselBufferSize";s.value=o+" in carouselItems"+f+c}return function(r,i,s){function u(){return 1>=r.totalIndex}function o(){return r.totalIndex>=P()-2}function c(){d&&r.$apply(function(){f(),x()})}function f(){if(d){var e=r.totalIndex-1,n=P()>0?P()-r.carouselBufferSize:Number.MAX_VALUE;r.carouselBufferStart,r.carouselBufferStart=Math.max(0,Math.min(e,n))}}function m(e){null===e&&(e=r.totalIndex);var n=null===M?Number.MAX_VALUE:P()-1;r.totalIndex=Math.max(0,Math.min(n,e))}function x(){if(d){var e=!1;if(o()&&(e=P()-1>r.totalIndex+1,!e&&angular.isDefined(s.rnCarouselNext))){var a=n(s.rnCarouselNext)(r,{index:r.totalIndex+1,item:r.carouselItems[r.carouselItems.length-1]});z.add("append",a)}if(u()&&(e=r.carouselBufferStart>0,!e&&angular.isDefined(s.rnCarouselPrev))){var t=n(s.rnCarouselPrev)(r,{index:0,item:r.carouselItems[0]});z.add("prepend",t)}}}function I(e,n){var a={};return a[e]=n,angular.forEach(L,function(t){a["-"+t.toLowerCase()+"-"+e]=n}),a}function v(e){return I("transform","translate3d("+e+"px,0,0)")}function p(){r.activeIndex=r.totalIndex-r.carouselBufferStart}function g(){var e=!1;return P(),d&&(r.totalIndex<r.carouselBufferStart?e=!0:r.totalIndex>r.carouselBufferStart+r.carouselBufferSize-1&&(e=!0),e&&f()),e}function h(e){m(null),e=g()||A===!0||e,w=(r.totalIndex-r.carouselBufferStart)*-M,e===!0?E.addClass("rn-carousel-noanimate").css(v(w)):E.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(v(w)),A=!1}t++;var C="rn-carousel-"+t,B=0,S=0,$=0,w=0,b=.1,M=null,A=!0,y=!1,E=i.wrap("<div id='"+C+"' class='rn-carousel-container'></div>"),N=E.parent();r.carouselItems=[],r.carouselBufferStart=0,r.totalIndex=0,r.activeIndex=0;var z={add:function(e,n){n&&(angular.isObject(n.promise)?n.promise.then(function(n){n&&z[e](n)}):angular.isFunction(n.then)?n.then(function(n){n&&z[e](n)}):z[e](n))},append:function(e){angular.isArray(e)?r.carouselItems=r.carouselItems.concat(e):r.carouselItems.push(e),f()},prepend:function(e){A=!0;var n=1;angular.isArray(e)?(n=e.length,r.carouselItems=e.concat(r.carouselItems)):r.carouselItems.splice(0,0,e),m(r.totalIndex+n)}},L=["webkit","moz"];if(d&&(r.carouselBufferSize=3,E[0].addEventListener("webkitTransitionEnd",c,!1),E[0].addEventListener("transitionend",c,!1),r.$watch("carouselBufferStart",function(){p(),h(!0)})),s.rnCarouselIndex){var D=n(s.rnCarouselIndex);angular.isFunction(D.assign)?(r.$watch("totalIndex",function(e){D.assign(r.$parent,e)}),r.$parent.$watch(D,function(e){m(e)})):isNaN(s.rnCarouselIndex)||m(parseInt(s.rnCarouselIndex,10))}r.$watch(l,function(e,n){r.carouselItems=e,e!==n&&(m(0),r.carouselBufferStart=0)});var k=r.$watch(l,function(){if(null===M){var e=E.find("li");M=0===e.length?E[0].getBoundingClientRect().width:e[0].getBoundingClientRect().width,N.css("width",M+"px"),k()}},!0);if(r.$watch("totalIndex",function(){h(!y),p(),!y&&d&&x(),y=!0}),angular.isDefined(s.rnCarouselIndicator)){var F=e("<div id='"+C+"-indicator' index='totalIndex' items='carouselItems' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(r);N.append(F)}var P=function(){return r.carouselItems.length};a.bind(E,{start:function(e){0===B&&(B=1,S=e.x)},move:function(e){if(0!==B){var n=e.x-S;if(1===B&&0!==n)B=2,$=w;else if(2===B){var a=P(),t=1;(0===r.totalIndex&&e.x>S||r.totalIndex===a-1&&S>e.x)&&(t=3),w=$+n/t,E.css(v(w)).removeClass("rn-carousel-animate").addClass("rn-carousel-noanimate")}}},end:function(e){if(B>0){B=0;var n=P(),a=$>w?1:-1,t=Math.min(Math.max(0,r.totalIndex+a),n-1),i=e.x-S;M*b>=Math.abs(i)&&(t=r.totalIndex);var s=r.totalIndex!==t;s?r.$apply(function(){m(t)}):r.$apply(function(){h()})}}})}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]);