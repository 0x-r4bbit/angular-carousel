/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.8 - 2013-05-25
 * @link http://revolunet.com.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-carousel",["ngMobile"]).filter("carouselSlice",function(){return function(e,a,t){return e.slice(a,t)}}).directive("rnCarousel",["$compile","$parse","$swipe",function(e,a,t){var n=0;return{restrict:"A",scope:!0,compile:function(r,i){r.addClass("rn-carousel-slides");var o=r.find("li")[0].attributes["ng-repeat"],s=o.value.match(/^([^\s]+) in (.+)$/i)[2],l=angular.isDefined(i.rnCarouselBuffered);if(l){var u="|carouselSlice:carouselBufferStart:carouselBufferStart+carouselBufferSize";o.value+=u}return function(r,i,o){function u(e,a){var t={};return t[e]=a,angular.forEach(w,function(n){t["-"+n.toLowerCase()+"-"+e]=a}),t}function c(e){return u("transform","translate3d("+e+"px,0,0)")}function d(){r.activeIndex=r.totalIndex-r.carouselBufferStart}n++;var f="rn-carousel-"+n,x=0,I=0,v=0,m=0,p=.1,B=0,C=!0,S=i.wrap("<div id='"+f+"' class='rn-carousel-container'></div>"),g=S.parent();r.carouselItems=[],r.carouselBufferStart=0,r.totalIndex=0,r.activeIndex=0;var h=function(e){S.addClass("rn-carousel-noanimate").css({left:e*B+"px"})},$=function(){var e=r.totalIndex>0&&0===r.activeIndex,t=r.totalIndex<M()-1&&r.activeIndex===S.find("li").length-1;if(e||t){var n=e?-1:1;h(r.carouselBufferStart+n),r.$apply(function(){r.carouselBufferStart+=n}),t&&o.rnCarouselOnEnd&&a(o.rnCarouselOnEnd)(r,{index:r.totalIndex+1})}},w=["webkit","moz"];if(l&&(r.carouselBufferSize=3,S[0].addEventListener("webkitTransitionEnd",$,!1),S[0].addEventListener("transitionend",$,!1),r.$watch("carouselBufferStart",function(){d()})),o.rnCarouselIndex){var b=a(o.rnCarouselIndex);angular.isFunction(b.assign)?(r.$watch("totalIndex",function(e){b.assign(r.$parent,e)}),r.$parent.$watch(b,function(e){r.totalIndex=e})):isNaN(o.rnCarouselIndex)||(r.totalIndex=parseInt(o.rnCarouselIndex,10))}if(r.$watch("totalIndex",function(e,a){e!==a&&z(),d()}),r.$watch(s,function(e){r.carouselItems=e;var a=S.find("li");0===B&&a.length>0?(B=a[0].getBoundingClientRect().width,g.css("width",B+"px"),z()):B=0},!0),angular.isDefined(o.rnCarouselIndicator)){var E=e("<div id='"+f+"-indicator' index='totalIndex' items='carouselItems' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(r);g.append(E)}var M=function(){return r.carouselItems.length},z=function(){var e=C===!0,a=M();0>r.totalIndex?r.totalIndex=0:r.totalIndex>a-1&&(r.totalIndex=a-1),l&&((r.totalIndex<r.carouselBufferStart||r.totalIndex>r.carouselBufferStart+r.carouselBufferSize-1)&&(r.carouselBufferStart=r.totalIndex-1,e=!0,h(r.carouselBufferStart)),r.carouselBufferStart=Math.max(0,Math.min(r.carouselBufferStart,a-r.carouselBufferSize)));var t=r.totalIndex*-B;e===!0?S.addClass("rn-carousel-noanimate").css(c(t)):S.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(c(t)),C=!1};t.bind(S,{start:function(e){0===x&&(x=1,I=e.x)},move:function(e){if(0!==x){var a=e.x-I;if(1===x&&0!==a)x=2,v=m;else if(2===x){var t=M(),n=1;(0===r.totalIndex&&e.x>I||r.totalIndex===t-1&&I>e.x)&&(n=3),m=v+a/n,S.css(c(m)).removeClass().addClass("rn-carousel-noanimate")}}},end:function(e){var a,t=M();if(x>0){x=0,a=v>m?r.totalIndex+1:r.totalIndex-1,a=Math.min(Math.max(a,0),t-1);var n=e.x-I;B*p>=Math.abs(n)&&(a=r.totalIndex);var i=r.totalIndex!==a;r.$apply(function(){r.totalIndex=a}),i||z()}}})}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]);