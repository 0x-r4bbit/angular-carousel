/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.8 - 2013-05-22
 * @link http://revolunet.com.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-carousel",["ngMobile"]).filter("carouselSlice",function(){return function(a,e,t){return a.slice(e,t)}}).directive("rnCarousel",["$compile","$parse","$swipe",function(a,e,t){var n=0;return{restrict:"A",scope:!0,compile:function(r,o){r.addClass("rn-carousel-slides");var s=r.find("li")[0].attributes["ng-repeat"],i=s.value.match(/^([^\s]+) in (.+)$/i)[2],l=angular.isDefined(o.rnCarouselBuffered);if(l){var u="|carouselSlice:carouselBufferStart:carouselBufferStart+carouselBufferSize";s.value+=u}return function(r,o,s){function u(a,e){var t={};return t[a]=e,angular.forEach($,function(n){t["-"+n.toLowerCase()+"-"+a]=e}),t}function c(){r.activeIndex=r.totalIndex-r.carouselBufferStart}n++;var d="rn-carousel-"+n,f=0,x=0,I=0,v=0,m=.1,p=0,B=!0,S=o.wrap("<div id='"+d+"' class='rn-carousel-container'></div>"),C=S.parent();r.carouselItems=[],r.carouselBufferStart=0,r.totalIndex=0,r.activeIndex=0;var g=function(a){S.addClass("rn-carousel-noanimate").css({left:a*p+"px"})},h=function(){var a=r.totalIndex>0&&0===r.totalIndex-r.carouselBufferStart,t=r.totalIndex<M()-1&&r.totalIndex-r.carouselBufferStart===S.find("li").length-1;if(a||t){var n=a?-1:1;g(r.carouselBufferStart+n),r.$apply(function(){r.carouselBufferStart+=n}),t&&s.rnCarouselOnEnd&&e(s.rnCarouselOnEnd)(r,{index:r.totalIndex+1})}},$=["webkit","moz"];if(l&&(r.carouselBufferSize=3,S[0].addEventListener("webkitTransitionEnd",h,!1),S[0].addEventListener("transitionend",h,!1),r.$watch("carouselBufferStart",function(){c()})),s.rnCarouselIndex){var w=e(s.rnCarouselIndex);angular.isFunction(w.assign)?(r.$watch("totalIndex",function(a){w.assign(r.$parent,a)}),r.$parent.$watch(w,function(a){r.totalIndex=a})):isNaN(s.rnCarouselIndex)||(r.totalIndex=parseInt(s.rnCarouselIndex,10))}r.$watch("totalIndex",function(a,e){a!==e&&z(),c()}),r.$watch(i,function(a){r.carouselItems=a;var e=S.find("li");e.length>0?(p=e[0].getBoundingClientRect().width,C.css("width",p+"px"),z()):p=0},!0);var b=angular.isDefined(s.rnCarouselIndicator);if(b){var E=a("<div id='"+d+"-indicator' index='totalIndex' items='carouselItems' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(r);C.append(E)}var M=function(){return r.carouselItems.length},z=function(){var a=B===!0;0>r.totalIndex?r.totalIndex=0:r.totalIndex>M()-1&&(r.totalIndex=M()-1),l&&((r.totalIndex<r.carouselBufferStart||r.totalIndex>r.carouselBufferStart+r.carouselBufferSize-1)&&(r.carouselBufferStart=r.totalIndex-1,a=!0,g(r.carouselBufferStart)),r.carouselBufferStart=Math.max(0,Math.min(r.carouselBufferStart,M()-r.carouselBufferSize))),v=r.totalIndex*-p,a===!0?S.addClass("rn-carousel-noanimate").css(u("transform","translate3d("+v+"px,0,0)")):S.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(u("transform","translate3d("+v+"px,0,0)")),B=!1};t.bind(S,{start:function(a){0===f&&(f=1,x=a.x)},move:function(a){if(0!==f){var e=a.x-x;if(1===f&&0!==e)f=2,I=v;else if(2===f){var t=M(),n=1;(0===r.totalIndex&&a.x>x||r.totalIndex===t-1&&x>a.x)&&(n=3),v=I+e/n,S.css(u("transform","translate3d("+v+"px,0,0)")).removeClass().addClass("rn-carousel-noanimate")}}},end:function(a){var e,t=M();if(f>0){f=0,e=I>v?r.totalIndex+1:r.totalIndex-1,e=Math.min(Math.max(e,0),t-1);var n=a.x-x;p*m>=Math.abs(n)&&(e=r.totalIndex);var o=r.totalIndex!==e;r.$apply(function(){r.totalIndex=e}),o||z()}}})}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]);