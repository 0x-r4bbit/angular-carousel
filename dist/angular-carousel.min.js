/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.8 - 2013-06-25
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["ngMobile"]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]),angular.module("angular-carousel").directive("rnCarousel",["$compile","$parse","$swipe","CollectionManager",function(t,e,i,n){var s=0;return{restrict:"A",scope:!0,compile:function(o,r){o.addClass("rn-carousel-slides");var a=o.find("li")[0].attributes,l=a["ng-repeat"];if(l||(l=a["data-ng-repeat"]),l||(l=a["x-ng-repeat"]),!l)throw Error("carousel: cannot find the ngRepeat attribute");var u=l.value.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),c=u[1],h=u[2],f=u[3]||"",d=angular.isDefined(r.rnCarouselBuffered);return l.value=c+" in carouselCollection.cards"+f,function(o,r,a){function l(t){!t.target||t.target!==w[0]||"transform"!==t.propertyName&&"-webkit-transform"!==t.propertyName&&"-moz-transform"!==t.propertyName||o.$apply(function(){c(),o.carouselCollection.adjustBuffer(),m(!0)})}function u(t,e){var i="after"===t?"push":"unshift";e&&(angular.isObject(e.promise)?e.promise.then(function(t){t&&(S=!0,o.carouselCollection[i](t,!0))}):angular.isFunction(e.then)?e.then(function(t){t&&(S=!0,o.carouselCollection[i](t,!0))}):(S=!0,o.carouselCollection[i](e,!0)))}function c(){var t=o.carouselCollection.position,i=o.carouselCollection.getLastIndex(),n=null;0===t&&angular.isDefined(a.rnCarouselPrev)&&(n=e(a.rnCarouselPrev)(o,{item:o.carouselCollection.cards[0]}),u("before",n)),t===i&&angular.isDefined(a.rnCarouselNext)&&(n=e(a.rnCarouselNext)(o,{item:o.carouselCollection.cards[o.carouselCollection.cards.length-1]}),u("after",n))}function f(t,e){var i={};return i[t]=e,angular.forEach(j,function(n){i["-"+n.toLowerCase()+"-"+t]=e}),i}function p(t){return f("transform","translate3d("+t+"px,0,0)")}function g(){var t=w.find("li");return M=0===t.length?w[0].getBoundingClientRect().width:t[0].getBoundingClientRect().width,B.css("width",M+"px"),M}function m(t){S=!!t||S,0===M&&g(),b=o.carouselCollection.getRelativeIndex()*-M,S===!0?w.removeClass("rn-carousel-animate").addClass("rn-carousel-noanimate").css(p(b)):w.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(p(b)),S=!1}s++;var x="rn-carousel-"+s,C=0,v=0,y=0,b=0,I=.1,M=0,S=!0,w=r.wrap("<div id='"+x+"' class='rn-carousel-container'></div>"),B=w.parent(),L=e(h),$={},z=0;if(a.rnCarouselIndex){var T=e(a.rnCarouselIndex);angular.isFunction(T.assign)?(o.$watch("carouselCollection.index",function(t){T.assign(o.$parent,t)}),z=T(o),o.$parent.$watch(T,function(t){void 0!==t&&o.carouselCollection.goToIndex(t,!0)})):isNaN(a.rnCarouselIndex)||(z=parseInt(a.rnCarouselIndex,10))}angular.isDefined(a.rnCarouselCycle)&&($.cycle=!0),$.index=z,d&&($.bufferSize=3,$.buffered=!0),o.carouselCollection=n.create($),o.$watch("carouselCollection.updated",function(t){t&&m()});var D=!1;o.$watch(L,function(t){o.carouselCollection.setItems(t,D),D=!0,0===M&&g(),m()});var j=["webkit","moz"];if(w[0].addEventListener("webkitTransitionEnd",l,!1),w[0].addEventListener("transitionend",l,!1),angular.isDefined(a.rnCarouselIndicator)){var A=t("<div id='"+x+"-indicator' index='carouselCollection.index' items='carouselCollection.items' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(o);B.append(A)}i.bind(w,{start:function(t){0===C&&(C=1,v=t.x)},move:function(t){if(0!==C){var e=t.x-v;if(1===C&&0!==e)C=2,y=b;else if(2===C){var i=o.carouselCollection.getLastIndex(),n=o.carouselCollection.position,s=1;(0===n&&t.x>v||n===i&&v>t.x)&&(s=3),b=y+e/s,w.css(p(b)).removeClass("rn-carousel-animate").addClass("rn-carousel-noanimate")}}},end:function(t){if(0===M&&g(),C>0){C=0;var e=o.carouselCollection.getLastIndex(),i=o.carouselCollection.position,n=y>b?1:-1,s=Math.min(Math.max(0,i+n),e),r=t.x-v;M*I>=Math.abs(r)&&(s=i);var l=i!==s;l?o.$apply(function(){angular.isDefined(a.rnCarouselCycle)&&(o.carouselCollection.position=s,m()),o.carouselCollection.goTo(s,!0)}):o.$apply(function(){m()})}}})}}}}]),angular.module("angular-carousel").service("CollectionManager",[function(){function t(t){var e,i={bufferSize:0,bufferStart:0,buffered:!1,cycle:!1,cycleOffset:0,index:0,position:0,items:[],cards:[],updated:null,debug:!1};if(t)for(e in t)i[e]=t[e];for(e in i)this[e]=i[e];angular.extend(this,i,t),this.init()}return t.prototype.log=function(){this.debug&&console.log.apply(console,arguments)},t.prototype.getPositionFromIndex=function(t){return(t+this.cycleOffset)%this.length()},t.prototype.goToIndex=function(t,e){if(t=Math.max(0,Math.min(t,this.getLastIndex())),this.updated&&t===this.index)return this.log("skip position change(same)"),!1;var i=this.getPositionFromIndex(t);return this.goTo(i,e)},t.prototype.goTo=function(t,e){if(this.log("goto start",t,e),0===this.length())return this.log("empty, skip gotoIndex"),void 0;t=Math.max(0,Math.min(t,this.getLastIndex()));var i=!1;this.cycle&&(0===t?(this.log("cycleAtBeginning",t),this.cycleAtBeginning(),t=1,this.cycleOffset++,i=!0):t===this.getLastIndex()&&(this.log("cycleAtEnd",t),this.cycleAtEnd(),t--,this.cycleOffset--,i=!0),this.cycleOffset%=this.length()),this.position=Math.max(0,Math.min(t,this.getLastIndex()));var n=(this.position-this.cycleOffset+this.length())%this.length();this.index=Math.max(0,Math.min(n,this.getLastIndex())),e||this.adjustBuffer(),i||(this.updated=new Date)},t.prototype.next=function(){this.cycle?this.goTo((this.position+1)%this.length()):this.goTo(Math.min(this.position+1,this.getLastIndex()))},t.prototype.prev=function(){if(this.cycle)this.goTo((this.position-1+this.length())%this.length());else{var t=this.length()>0?Math.max(0,(this.position-1)%this.length()):0;this.goTo(t)}},t.prototype.setBufferSize=function(t){this.log("setBufferSize",t),this.bufferSize=t,this.adjustBuffer()},t.prototype.isBuffered=function(){return this.buffered},t.prototype.getRelativeIndex=function(){var t=Math.max(0,Math.min(this.getLastIndex(),this.position-this.bufferStart));return t},t.prototype.adjustBuffer=function(){var t=(this.getLastIndex()+1-this.bufferSize)%this.length();this.log("maxBufferStart",t),this.bufferStart=Math.max(0,Math.min(t,this.position-1)),this.cards=this.items.slice(this.bufferStart,this.bufferStart+this.bufferSize),this.log("adjustBuffer from",this.bufferStart,"to",this.bufferStart+this.bufferSize)},t.prototype.length=function(){return this.items.length},t.prototype.getLastIndex=function(){var t=Math.max(0,this.length()-1);return t},t.prototype.init=function(){this.setBufferSize(this.bufferSize||this.length()),this.length()>0&&this.goToIndex(this.index)},t.prototype.setItems=function(t,e){this.log("setItems",t,e),e&&(this.index=0,this.position=0),this.items=t,this.init()},t.prototype.cycleAtEnd=function(){this.push(this.items.shift())},t.prototype.push=function(t,e){this.log("push item(s)",t,e),this.items.push(t),e&&(this.adjustBuffer(),this.updated=new Date),this.buffered||this.bufferSize++},t.prototype.unshift=function(t,e){this.log("unshift item(s)",t,e),this.items.unshift(t),this.buffered||this.bufferSize++,e&&(this.position++,this.adjustBuffer(),this.updated=new Date)},t.prototype.cycleAtBeginning=function(){this.unshift(this.items.pop())},{create:function(e){return new t(e)}}}]);