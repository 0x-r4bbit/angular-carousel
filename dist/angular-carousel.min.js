/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.0.6 - 2013-05-14
 * @link http://revolunet.com.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-carousel",["ngMobile"]).filter("carouselSlice",function(){return function(e,r,a){return e.slice(r,a)}}).directive("rnCarousel",["$document","$compile","$parse","$timeout","$swipe",function(e,r,a,n,s){var t=0;return{restrict:"A",scope:!0,compile:function(e,n){e.addClass("rn-carousel-slides");var u=e.find("li")[0].attributes["ng-repeat"],o=u.value.match(/^([^\s]+) in (.+)$/i)[2],c=angular.isDefined(n.rnCarouselBuffered);if(c){var i="|carouselSlice:carouselBufferStart:carouselBufferStart+carouselBufferSize";u.value+=i}return function(e,n,u){function i(e,r){var a={};return a[e]=r,angular.forEach($,function(n){a["-"+n.toLowerCase()+"-"+e]=r}),a}function l(){e.$watch("carouselIndex",function(e,r){e!==r&&z()})}t++;var d="rn-carousel-"+t,f=0,x=0,I=0,v=0,m=.1,p=0,B=!0,C=n.wrap("<div id='"+d+"' class='rn-carousel-container'></div>"),S=C.parent();e.carouselItems=[],e.carouselIndex=0;var g=function(e){C.addClass("rn-carousel-noanimate").css({"padding-left":e*p+"px"})},h=function(){var r=e.carouselIndex>0&&0===e.carouselIndex-e.carouselBufferStart,n=e.carouselIndex<M()-1&&e.carouselIndex-e.carouselBufferStart===C.find("li").length-1;if(r||n){var s=r?-1:1;g(e.carouselBufferStart+s),e.$apply(function(){e.carouselBufferStart+=s}),n&&u.rnCarouselOnEnd&&a(u.rnCarouselOnEnd)(e,{index:e.carouselIndex+1})}},$=["webkit","moz"];if(c&&(e.carouselBufferSize=3,e.carouselBufferStart=0,C[0].addEventListener("webkitTransitionEnd",h,!1),C[0].addEventListener("transitionend",h,!1)),u.rnCarouselIndex){var w=a(u.rnCarouselIndex);angular.isFunction(w.assign)?(e.$watch("carouselIndex",function(r){w.assign(e.$parent,r)}),e.$parent.$watch(w,function(r,a){e.carouselIndex=r,r!==a&&z()})):isNaN(u.rnCarouselIndex)||(l(),e.carouselIndex=parseInt(u.rnCarouselIndex,10))}else l();e.$watch(o,function(r){e.carouselItems=r;var a=C.find("li");a.length>0?(p=a[0].getBoundingClientRect().width,S.css("width",p+"px"),z()):p=0},!0);var b=angular.isDefined(u.rnCarouselIndicator);if(b){var E=r("<div id='"+d+"-indicator' index='carouselIndex' items='carouselItems' data-rn-carousel-indicators class='rn-carousel-indicator'></div>")(e);S.append(E)}var M=function(){return e.carouselItems.length},z=function(){var r=B===!0;0>e.carouselIndex&&(e.carouselIndex=0),e.carouselIndex>M()-1&&(e.carouselIndex=M()-1),c&&((e.carouselIndex<e.carouselBufferStart||e.carouselIndex>e.carouselBufferStart+e.carouselBufferSize-1)&&(e.carouselBufferStart=e.carouselIndex-1,r=!0,g(e.carouselBufferStart)),e.carouselBufferStart=Math.max(0,Math.min(e.carouselBufferStart,M()-e.carouselBufferSize))),v=e.carouselIndex*-p,r===!0?C.addClass("rn-carousel-noanimate").css(i("transform","translate3d("+v+"px,0,0)")):C.removeClass("rn-carousel-noanimate").addClass("rn-carousel-animate").css(i("transform","translate3d("+v+"px,0,0)")),B=!1};s.bind(C,{start:function(e){0===f&&(f=1,x=e.x)},move:function(r){if(0!==f){var a=r.x-x;if(1===f&&0!==a)f=2,I=v;else if(2===f){var n=M(),s=1;(0===e.carouselIndex&&r.x>x||e.carouselIndex===n-1&&x>r.x)&&(s=3),v=I+a/s,C.css(i("transform","translate3d("+v+"px,0,0)")).removeClass().addClass("rn-carousel-noanimate")}}},end:function(r){var a,n=M();if(f>0){f=0,a=I>v?e.carouselIndex+1:e.carouselIndex-1,a=Math.min(Math.max(a,0),n-1);var s=r.x-x;p*m>=Math.abs(s)&&(a=e.carouselIndex);var t=e.carouselIndex!==a;e.$apply(function(){e.carouselIndex=a}),t||z()}}})}}}}]).directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]);